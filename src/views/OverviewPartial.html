
  <ion-page>
    <ion-content>
      <ion-grid>
        <ion-row>
          <ion-col size-sm>
            <div id="map-container">
              <div id="map"></div>
            </div>
            <span
              ><ion-button
                size="small"
                v-on:click="switchBasemap('streets')"
                shape="round"
                >Streets</ion-button
              >
              <ion-button
                size="small"
                v-on:click="switchBasemap('aerials')"
                shape="round"
                >Aerials</ion-button
              ></span
            >
          </ion-col>
          <ion-col size="auto" size-sm>
            <ion-card>
              <ion-row>
                <ion-col size="auto">
                  <ion-card-title
                    >Company: {{ userDetails.company }}
                    <ion-spinner
                      v-if="refreshInProgress"
                      name="circles"
                    ></ion-spinner
                  ></ion-card-title>
                </ion-col>
              </ion-row>
            </ion-card>
            <vue-collapsible-panel-group>

            <div v-for="(feedItemValue, feedItemKey) in latestDevicesCx7500Feed">
              <vue-collapsible-panel>
                <template #title>
                  {{feedItemKey}}
                </template>
                <template #content>
                  <div
                  v-for="item in feedItemValue"
                  v-bind:key="item.device_id"
                >
                  <ion-card>
                    <ion-row>
                      <ion-col size="auto">
                        <ion-card-subtitle
                          >Device Name:
                          <b>{{ item.device_alias }}</b></ion-card-subtitle
                        >
                        <div
                          v-if="
                            item.device_feed && item.device_feed.holding_registers
                          "
                        >
                          <ion-card-subtitle
                            >Last Published At:
                            <b>{{
                              item.device_feed.publishedAt
                            }}</b></ion-card-subtitle
                          >
                          <div
                            v-for="item in item.device_feed.holding_registers"
                            v-bind:key="item.alias"
                          >
                            <ion-card-subtitle
                              float-right
                              v-if="item.alias === 'Key Position'"
                            >
                              <span v-if="item.value === 'Key in Auto'"
                                >{{ item.alias }}:
                                <b class="color-text-green">{{ item.value }}</b>
                                <ion-badge class="color-full-green"
                                  >O</ion-badge
                                ></span
                              >
                              <span v-else-if="item.value === 'Not Available'"
                                >{{ item.alias }}:
                                <b class="color-text-black">{{ item.value }}</b>
                                <ion-badge class="color-full-black"
                                  >O</ion-badge
                                ></span
                              >
                              <span v-else
                                >{{ item.alias }}:
                                <b class="color-text-red">{{ item.value }}</b>
                                <ion-badge class="color-full-red"
                                  >O</ion-badge
                                ></span
                              >
                            </ion-card-subtitle>
    
                            <ion-card-subtitle
                              float-right
                              v-else-if="item.alias === 'Amber Warning Lamp'"
                            >
                              <span
                                v-if="
                                  item.value === 'On, Solid' ||
                                  item.value === 'On, Flashing'
                                "
                                >{{ item.alias }}:
                                <b class="color-text-amber">{{ item.value }}</b>
                                <ion-badge class="color-full-amber"
                                  >O</ion-badge
                                ></span
                              >
                              <span v-else
                                >{{ item.alias }}:
                                <b class="color-text-black">{{ item.value }}</b>
                                <ion-badge class="color-full-black"
                                  >O</ion-badge
                                ></span
                              >
                            </ion-card-subtitle>
    
                            <ion-card-subtitle
                              float-right
                              v-else-if="item.alias === 'Red Stop Lamp'"
                            >
                              <span
                                v-if="
                                  item.value === 'On, Solid' ||
                                  item.value === 'On, Flashing'
                                "
                                >{{ item.alias }}:
                                <b class="color-text-red">{{ item.value }}</b>
                                <ion-badge class="color-full-red"
                                  >O</ion-badge
                                ></span
                              >
                              <span v-else
                                >{{ item.alias }}:
                                <b class="color-text-black">{{ item.value }}</b>
                                <ion-badge class="color-full-black"
                                  >O</ion-badge
                                ></span
                              >
                            </ion-card-subtitle>
    
                            <ion-card-subtitle v-else float-right
                              >{{ item.alias }}: <b>{{ item.value }}</b>
                              <span v-if="item.value != 'Not Available'">{{
                                item.unit
                              }}</span>
                            </ion-card-subtitle>
                          </div>
                          <ion-button
                            size="small"
                            v-on:click="openEngineControlModal(item)"
                            shape="round"
                            >Control</ion-button
                          >
                        </div>
                        <div v-else>Device Status: Offline</div>
                      </ion-col>
                    </ion-row>
                  </ion-card>
                  </div>
                </template>
              </vue-collapsible-panel>
              

            </div>
            
            <div v-for="(feedItemValue, feedItemKey) in latestDevicesVfdX600Feed">
            <vue-collapsible-panel>
              <template #title>
                {{feedItemKey}}
              </template>
              <template #content>
                <div
                v-for="item in feedItemValue"
                v-bind:key="item.device_id"
              >
                <ion-card>
                  <ion-row>
                    <ion-col size="auto">
                      <ion-card-subtitle
                        >Device Name:
                        <b>{{ item.device_alias }}</b></ion-card-subtitle
                      >
                      <div
                        v-if="
                          item.device_feed && item.device_feed.holding_registers
                        "
                      >
                        <ion-card-subtitle
                          >Last Published At:
                          <b>{{
                            item.device_feed.publishedAt
                          }}</b></ion-card-subtitle
                        >
                        <div
                          v-for="item in item.device_feed.coils"
                          v-bind:key="item.alias"
                        >
                          <ion-card-subtitle
                            float-right
                            v-if="
                              item.alias === 'Auto Mode' ||
                              item.alias === 'Start/Stop Mode'
                            "
                          >
                            <span v-if="item.value === 'On'"
                              >{{ item.alias }}:
                              <b class="color-text-green">{{ item.value }}</b>
                              <ion-badge class="color-full-green"
                                >O</ion-badge
                              ></span
                            >
                            <span v-else
                              >{{ item.alias }}:
                              <b class="color-text-black">{{ item.value }}</b>
                              <ion-badge class="color-full-black"
                                >O</ion-badge
                              ></span
                            >
                          </ion-card-subtitle>
                        </div>
  
                        <div
                          v-for="item in item.device_feed.discrete_inputs"
                          v-bind:key="item.alias"
                        >
                          <ion-card-subtitle
                            float-right
                            v-if="item.alias === 'Red Stop Lamp'"
                          >
                            <span v-if="item.value === 'On'"
                              >{{ item.alias }}:
                              <b class="color-text-red">{{ item.value }}</b>
                              <ion-badge class="color-full-red"
                                >O</ion-badge
                              ></span
                            >
                            <span v-else
                              >{{ item.alias }}:
                              <b class="color-text-black">{{ item.value }}</b>
                              <ion-badge class="color-full-black"
                                >O</ion-badge
                              ></span
                            >
                          </ion-card-subtitle>
                          <ion-card-subtitle
                            float-right
                            v-else-if="
                              item.alias === 'VFD Run Status Verification'
                            "
                          >
                            <span v-if="item.value === 'On'"
                              >{{ item.alias }}:
                              <b class="color-text-green">{{ item.value }}</b>
                              <ion-badge class="color-full-green"
                                >O</ion-badge
                              ></span
                            >
                            <span v-else
                              >{{ item.alias }}:
                              <b class="color-text-black">{{ item.value }}</b>
                              <ion-badge class="color-full-black"
                                >O</ion-badge
                              ></span
                            >
                          </ion-card-subtitle>
                          <ion-card-subtitle
                            float-right
                            v-else-if="item.alias === 'Backup Power'"
                          >
                            <span v-if="item.value === 'On'"
                              >{{ item.alias }}:
                              <b class="color-text-red">{{ item.value }}</b>
                              <ion-badge class="color-full-red"
                                >O</ion-badge
                              ></span
                            >
                            <span v-else
                              >{{ item.alias }}:
                              <b class="color-text-green">{{ item.value }}</b>
                              <ion-badge class="color-full-green"
                                >O</ion-badge
                              ></span
                            >
                          </ion-card-subtitle>
                        </div>
  
                        <div
                          v-for="item in item.device_feed.coils"
                          v-bind:key="item.alias"
                        >
                          <ion-card-subtitle
                            float-right
                            v-if="item.alias === 'Amber Warning Lamp'"
                          >
                            <span v-if="item.value === 'On'"
                              >{{ item.alias }}:
                              <b class="color-text-amber">{{ item.value }}</b>
                              <ion-badge class="color-full-amber"
                                >O</ion-badge
                              ></span
                            >
                            <span v-else
                              >{{ item.alias }}:
                              <b class="color-text-black">{{ item.value }}</b>
                              <ion-badge class="color-full-black"
                                >O</ion-badge
                              ></span
                            >
                          </ion-card-subtitle>
                        </div>
  
                        <div
                          v-for="item in item.device_feed.holding_registers"
                          v-bind:key="item.alias"
                        >
                          <ion-card-subtitle float-right
                            >{{ item.alias }}: <b>{{ item.value }}</b>
                            <span v-if="item.value != 'Not Available'">{{
                              item.unit
                            }}</span>
                          </ion-card-subtitle>
                        </div>
  
                        <ion-button
                          size="small"
                          v-on:click="openVfdControlModal(item)"
                          shape="round"
                          >Control</ion-button
                        >
                      </div>
                      <div v-else>Device Status: Offline</div>
                    </ion-col>
                  </ion-row>
                </ion-card>
              </div>
              </template>
            </vue-collapsible-panel>
            </div>

            </vue-collapsible-panel-group>
          </ion-col>
        </ion-row>
      </ion-grid>
    </ion-content>
  </ion-page>
